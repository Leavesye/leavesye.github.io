webpackJsonp([7],{"1hDl":function(e,t,n){var a=n("Jq2h");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("8bSs")("47681704",a,!0)},"5Qsf":function(e,t,n){"use strict";var a={name:"condition-design",props:{list:{type:Array}},data:function(){return{rangeNum:["",""]}},methods:{changeRange:function(e){e.inputValue=this.rangeNum[0]+"-"+this.rangeNum[1]}}},i={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",e._l(e.list,function(t,a){return n("div",{key:t.key,staticClass:"flex"},[n("div",{staticClass:"flex-l"},[t.level>1?n("div",{staticClass:"connect-box",style:t.style},[n("div",{staticClass:"connect-box-inner"},[n("div",{staticClass:"logic-btn",class:{active:t.isSelect}},[n("el-dropdown",{attrs:{trigger:"click"}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n                "+e._s("or"==t.operator?"或":"和")+"\n                "),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.isRoot&&t.level<3?n("el-dropdown-item",{nativeOn:{click:function(e){t.funcs.handleSelectItem(t,a)}}},[e._v(e._s(t.isSelect?"取消选择":"选择"))]):e._e(),e._v(" "),t.isRoot?n("el-dropdown-item",{nativeOn:{click:function(e){t.funcs.handleCancelGroup(t,a)}}},[e._v("取消组")]):e._e(),e._v(" "),n("el-dropdown-item",{nativeOn:{click:function(e){t.funcs.handleChangeLogic(t,a)}}},[e._v("更改为"+e._s("or"==t.operator?"和":"或"))]),e._v(" "),n("el-dropdown-item",{nativeOn:{click:function(n){t.funcs.handleDeleteItem(e.list,t,t.key,a)}}},[e._v("删除")])],1)],1)],1)])]):e._e(),e._v(" "),1==t.level?n("div",{staticClass:"line"}):e._e(),e._v(" "),n("el-dropdown",{attrs:{trigger:"click"}},[n("div",{staticClass:"el-dropdown-link"},[1==t.level?n("div",{staticClass:"inner-btn",class:{active:t.isSelect}},[n("i",{staticClass:"el-icon-arrow-down"})]):e._e()]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.isRoot?n("el-dropdown-item",{nativeOn:{click:function(e){t.funcs.handleSelectItem(t,a)}}},[e._v(e._s(t.isSelect?"取消选择":"选择"))]):e._e(),e._v(" "),n("el-dropdown-item",{nativeOn:{click:function(n){t.funcs.handleDeleteItem(e.list,t,t.key,a)}}},[e._v("删除")])],1)],1)],1),e._v(" "),n("div",{staticClass:"flex-r"},[1==t.level?n("div",{staticClass:"input-group"},[n("div",{staticClass:"cascader"},[n("el-cascader",{staticStyle:{width:"100%"},attrs:{options:t.cascadeOptions,clearable:"",separator:"=====>"},on:{change:function(e){t.funcs.handleCascaderChange(e,t,a)}},model:{value:t.selectValue,callback:function(n){e.$set(t,"selectValue",n)},expression:"info.selectValue"}}),e._v(" "),t.selectValue&&!t.selectValue.length?n("span",{staticClass:"input-valid"},[e._v("此处不能为空")]):e._e()],1),e._v(" "),n("div",{staticClass:"right-input"},[1==t.type?n("el-input",{attrs:{clearable:""},model:{value:t.inputValue,callback:function(n){e.$set(t,"inputValue",n)},expression:"info.inputValue"}}):e._e(),e._v(" "),2==t.type?n("el-select",{attrs:{clearable:""},model:{value:t.inputValue,callback:function(n){e.$set(t,"inputValue",n)},expression:"info.inputValue"}},e._l(t.options,function(e){return n("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})):e._e(),e._v(" "),3==t.type?n("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:t.inputValue,callback:function(n){e.$set(t,"inputValue",n)},expression:"info.inputValue"}}):e._e(),e._v(" "),4==t.type?n("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"daterange","range-separator":"至"},model:{value:t.inputValue,callback:function(n){e.$set(t,"inputValue",n)},expression:"info.inputValue"}}):e._e(),e._v(" "),5==t.type?n("el-dropdown",{attrs:{trigger:"click"}},[n("span",{staticClass:"el-dropdown-link"},[n("el-input",{attrs:{clearable:""},model:{value:t.inputValue,callback:function(n){e.$set(t,"inputValue",n)},expression:"info.inputValue"}})],1),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("div",{staticClass:"range-box"},[n("el-input",{on:{change:function(n){e.changeRange(t)}},model:{value:e.rangeNum[0],callback:function(t){e.$set(e.rangeNum,0,t)},expression:"rangeNum[0]"}}),e._v("\n                  -\n                "),n("el-input",{on:{change:function(n){e.changeRange(t)}},model:{value:e.rangeNum[1],callback:function(t){e.$set(e.rangeNum,1,t)},expression:"rangeNum[1]"}})],1)])],1):e._e(),e._v(" "),null==t.inputValue||t.inputValue?e._e():n("span",{staticClass:"input-valid"},[e._v("此处不能为空")])],1)]):e._e(),e._v(" "),t.level>1?n("condition-design",{attrs:{list:t.item}}):e._e()],1)])}))},staticRenderFns:[]};var o=n("vSla")(a,i,!1,function(e){n("VM/Q")},null,null);t.a=o.exports},"6Qm0":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("4YfN"),i=n.n(a),o=n("IHPB"),s=n.n(o),l=n("5VXh"),r=n("0j9R"),c=n("YvLT"),d=n("5Qsf"),u=n("3cXf"),h=n.n(u),p=n("HzJ8"),g=n.n(p),f={name:"SegmentNodes",data:function(){return{isActivated:!1,visible:!1,props:{value:"tagTypeName",label:"tagTypeName",children:"tags"},selectedOptions:[],nodeContainerH:"",tagInfo:[],showInputText:!1,showDateText:!1,showSliderText:!1,showTableText:!1,showDate:!1,showSegmentTb:!1,inputText:"",tableText:"",tableValObj:[],dateValue:[],dateValue2:[],sliderValue:[0,0],selectId:0,myNode:{},forthSelects:[],nodeFItem:{group:"",tag:"",tagDbDefine:"",tagDsTable:"",operation:"",value:""}}},props:{dataInfo:{},filterItem:{},addNodeId:{},hasFather:{},father:{type:Object,default:function(){return{level:0}}}},mounted:function(){this.init()},updated:function(){void 0!==this.$refs.elememt&&(this.nodeContainerH=this.$refs.elememt.offsetHeight-74,this.nodeContainerH>0&&this.nodeContainerH<10&&(this.nodeContainerH=0))},methods:{init:function(){this.initSelections(),this.initSelectionsValue()},initSelections:function(){var e=document.getElementsByClassName("isActivated");if(void 0!==e[0])for(var t=0;t<e.length;t++)e[t].setAttribute("class","node-container");this.nodeFItem=this.filterItem,this.tagInfo=this.dataInfo.tagInfo;for(var n=0;n<this.tagInfo.length;n++)for(var a=0;a<this.tagInfo[n].tags.length;a++){var i=this.tagInfo[n].tags[a].tagDefine;switch(this.tagInfo[n].tags[a].tagTypeName=this.tagInfo[n].tags[a].tagCn,this.tagInfo[n].tags[a].tagTypeId=this.tagInfo[n].tags[a].tagId,i){case"int":this.putIntoSelects(n,a,this.dataInfo.operationNumberSelect);break;case"list":this.tagInfo[n].tags[a].tags=this.tagInfo[n].tags[a].tagValueList,this.putIntoSelects(n,a,this.dataInfo.operationBoolSelect);break;case"float":this.putIntoSelects(n,a,this.dataInfo.operationBoolSelect);break;case"intrange":this.putIntoSelects(n,a,this.dataInfo.operationRangeSelect);break;case"multiselect":this.putIntoSelects(n,a,this.dataInfo.operationMultiSelect);break;case"string":this.putIntoSelects(n,a,this.dataInfo.operationStringSelect);break;case"daterange":this.putIntoSelects(n,a,this.dataInfo.operationRangeSelect);break;case"datetime":this.putIntoSelects(n,a,this.dataInfo.operationDatetimeSelect)}if(void 0!==this.tagInfo[n].tags[a].tagValueList){for(var o=0;o<this.tagInfo[n].tags[a].tagValueList.length;o++)this.tagInfo[n].tags[a].tagValueList[o].tagTypeName=this.tagInfo[n].tags[a].tagValueList[o].text,this.tagInfo[n].tags[a].tagValueList[o].tagTypeId=this.tagInfo[n].tags[a].tagValueList[o].value;for(var s=0;s<this.tagInfo[n].tags[a].tags.length;s++)this.tagInfo[n].tags[a].tags[s].tags=this.tagInfo[n].tags[a].tagValueList}}this.nodeContainerH=this.$refs.elememt.offsetHeight-74,this.nodeContainerH>0&&this.nodeContainerH<10&&(this.nodeContainerH=0)},initSelectionsValue:function(){var e=this.nodeFItem.value;this.selectedOptions.push(this.nodeFItem.group);for(var t=0;t<this.tagInfo.length;t++)if(this.tagInfo[t].tagTypeName===this.nodeFItem.group)for(var n=0;n<this.tagInfo[t].tags.length;n++){var a=this.tagInfo[t].tags[n].tagDefine;switch(this.tagInfo[t].tags[n].tagTypeName=this.tagInfo[t].tags[n].tagCn,this.tagInfo[t].tags[n].tags=this.tagInfo[t].tags[n].tagValueList,this.tagInfo[t].tags[n].tagTypeId=this.tagInfo[t].tags[n].tagId,this.nodeFItem.tag!==this.tagInfo[t].tags[n].tagEn&&this.tagInfo[t].tags[n].tagId!==parseInt(this.nodeFItem.tag)||this.selectedOptions.push(this.tagInfo[t].tags[n].tagCn),a){case"multiselect":if(this.initCurrentSelect(this.dataInfo.operationMultiSelect),this.tagInfo[t].tags[n].tagId===parseInt(this.nodeFItem.tag)){this.showTableText=!0;var i=this.nodeFItem.value;this.tableValObj=JSON.parse(i.split("'").join('"'));for(var o=0;o<this.tableValObj.length;o++)this.tableText=this.tableValObj[o].name+","+this.tableText}break;case"int":this.initCurrentSelect(this.dataInfo.operationNumberSelect),this.tagInfo[t].tags[n].tagId===parseInt(this.nodeFItem.tag)&&(this.showInputText=!0,this.inputText=e);break;case"list":this.initCurrentSelect(this.dataInfo.operationBoolSelect);var s=!0,l=!1,r=void 0;try{for(var c,d=g()(this.tagInfo[t].tags[n].tagValueList);!(s=(c=d.next()).done);s=!0){var u=c.value;u.tagTypeId+="",u.tagTypeId===this.nodeFItem.value&&this.selectedOptions.push(u.tagTypeName)}}catch(e){l=!0,r=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw r}}break;case"float":this.initCurrentSelect(this.dataInfo.operationBoolSelect);break;case"intrange":this.initCurrentSelect(this.dataInfo.operationRangeSelect),"order_sku_price"!==this.nodeFItem.tag&&this.tagInfo[t].tags[n].tagId!==parseInt(this.nodeFItem.tag)||(this.showSliderText=!0,this.sliderValue=this.nodeFItem.value.split("-"));break;case"string":this.initCurrentSelect(this.dataInfo.operationStringSelect);break;case"daterange":this.initCurrentSelect(this.dataInfo.operationRangeSelect),"order_create_date"!==this.nodeFItem.tag&&this.tagInfo[t].tags[n].tagId!==parseInt(this.nodeFItem.tag)||(this.showDateText=!0,this.dateValue=this.nodeFItem.value.split(" - "));break;case"datetime":this.initCurrentSelect(this.dataInfo.operationDatetimeSelect),this.tagInfo[t].tags[n].tagId===parseInt(this.nodeFItem.tag)&&(this.showDate=!0,this.dateValue2=this.nodeFItem.value)}}},putIntoSelects:function(e,t,n){var a=[],i=!0,o=!1,s=void 0;try{for(var l,r=g()(n);!(i=(l=r.next()).done);i=!0){var c=l.value;a.push({tagTypeName:c.text,tagTypeId:c.value})}}catch(e){o=!0,s=e}finally{try{!i&&r.return&&r.return()}finally{if(o)throw s}}this.tagInfo[e].tags[t].tags=a},initCurrentSelect:function(e){var t=!0,n=!1,a=void 0;try{for(var i,o=g()(e);!(t=(i=o.next()).done);t=!0){var s=i.value;s.value===this.nodeFItem.operation&&this.selectedOptions.push(s.text)}}catch(e){n=!0,a=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw a}}},getCurrentSelect:function(e,t){var n=!0,a=!1,i=void 0;try{for(var o,s=g()(e);!(n=(o=s.next()).done);n=!0){var l=o.value;l.text===t&&(this.myNode.operation=l.value)}}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}},hideAllInputText:function(){this.showInputText=!1,this.showSliderText=!1,this.showTableText=!1,this.showDateText=!1,this.showDate=!1},handleChange:function(e){for(var t=0;t<this.tagInfo.length;t++)for(var n=0;n<this.tagInfo[t].tags.length;n++){if(this.tagInfo[t].tags[n].tagTypeName===e[1])switch(this.hideAllInputText(),this.tagInfo[t].tags[n].tagDefine){case"int":this.showInputText=!0;break;case"intrange":this.showSliderText=!0;break;case"multiselect":this.showTableText=!0;break;case"daterange":this.showDateText=!0;break;case"datetime":this.showDate=!0}}if(3===e.length){this.myNode.group=e[0];for(var a=0;a<this.tagInfo.length;a++)if(this.tagInfo[a].tagTypeName===e[0])for(var i=0;i<this.tagInfo[a].tags.length;i++)if(this.tagInfo[a].tags[i].tagTypeName===e[1])switch(void 0!==this.tagInfo[a].tags[i].tags&&(this.forthSelects=this.tagInfo[a].tags[i].tags[0].tags),this.myNode.tag=this.tagInfo[a].tags[i].tagTypeId,this.myNode.tagDbDefine=this.tagInfo[a].tags[i].tagDefine,this.myNode.tagDsTable=this.tagInfo[a].tags[i].tagDsTable,this.myNode.tagDbDefine){case"int":this.getCurrentSelect(this.dataInfo.operationNumberSelect,e[2]);break;case"list":case"float":this.getCurrentSelect(this.dataInfo.operationBoolSelect,e[2]);break;case"intrange":this.getCurrentSelect(this.dataInfo.operationRangeSelect,e[2]);break;case"multiselect":this.getCurrentSelect(this.dataInfo.operationMultiSelect,e[2]);break;case"string":this.getCurrentSelect(this.dataInfo.operationStringSelect,e[2]);break;case"daterange":this.getCurrentSelect(this.dataInfo.operationRangeSelect,e[2]);break;case"datetime":this.getCurrentSelect(this.dataInfo.operationDatetimeSelect,e[2])}}else if(4===e.length){var o=!0,s=!1,l=void 0;try{for(var r,c=g()(this.forthSelects);!(o=(r=c.next()).done);o=!0){var d=r.value;d.text===e[3]&&(this.myNode.value=d.value)}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}void 0===this.addNodeId?(console.log(this.myNode),this.returnCurrentInfo(2,this.myNode,this.isActivated,this.nodeFItem)):this.returnCurrentInfo(2,this.myNode,this.isActivated,this.addNodeId)}},returnCurrentInfo:function(){this.hasFather?this.$emit("info",arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3],this.father,this.nodeFItem):this.$emit("info",arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3],arguments.length<=4?void 0:arguments[4],arguments.length<=5?void 0:arguments[5])},selectNode:function(e){1===e?this.selectedOptions.length<3?l.Message.warning({showClose:!0,message:"请选择好完整的内容"}):(this.isActivated=!this.isActivated,this.returnCurrentInfo(0,this.myNode,this.isActivated,this.addNodeId)):(this.isActivated=!this.isActivated,this.returnCurrentInfo(1,this.myNode,this.isActivated,this.nodeFItem))},cancelGroup:function(){this.$emit("cancel",this.nodeFItem)},cancelGroup2:function(){this.$emit("cancel",arguments.length<=0?void 0:arguments[0],this.nodeFItem)},blockInputChange:function(e){switch(e){case 0:this.myNode.value=this.inputText;break;case 1:this.myNode.value=this.dateValue[0]+" - "+this.dateValue[1];break;case 2:this.myNode.value=this.sliderValue[0]+"-"+this.sliderValue[1];break;case 3:this.myNode.value=this.dateValue2.split("/").join("-")}void 0===this.addNodeId?this.returnCurrentInfo(2,this.myNode,this.isActivated,this.nodeFItem):this.returnCurrentInfo(2,this.myNode,this.isActivated,this.addNodeId)},deleteMe:function(){this.$emit("delete",this.nodeFItem)},showsegmentTable:function(){this.selectObj=this.tableValObj,this.showSegmentTb=!0},closeTb:function(){this.showSegmentTb=!1},saveTb:function(){this.tableText="",this.tableValObj=arguments.length<=0?void 0:arguments[0];for(var e=0;e<this.tableValObj.length;e++)this.tableText=this.tableValObj[e].name+","+this.tableText;this.myNode.value=h()(arguments.length<=0?void 0:arguments[0]).replace(/\"/g,"'"),this.showSegmentTb=!1,this.returnCurrentInfo(2,this.myNode,this.isActivated,this.nodeFItem)},getSelections:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log(t)},getCurrentNodeInfo:function(){this.dataInfo.segmentJson},changOperator:function(e){"or"===e.operator?e.operator="and":e.operator="or"}},components:{SegmentNodes:v}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"elememt",staticClass:"node-container",class:{isActivated:e.isActivated}},[void 0===e.filterItem.group?n("div",{staticClass:"selectAll",class:{hide:1===e.filterItem.item.length||2===e.filterItem.level}},[1===e.filterItem.item.length||2===e.filterItem.level?n("span",{staticClass:"hide"}):3===e.filterItem.level?n("div",{staticClass:"lineBox level3",style:{top:26*e.filterItem.item[0].item.length+30+"px",bottom:26*e.filterItem.item[e.filterItem.item.length-1].item.length+30+"px"}}):n("div",{staticClass:"lineBox",class:{bottomNone:0===e.nodeContainerH},style:{height:e.nodeContainerH+"px"}}),e._v(" "),n("el-popover",{ref:"popoverAll",attrs:{placement:"top"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{staticClass:"text-center"},[n("div",[e._v(e._s(e.father))]),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:3!==e.father.level,expression:"father.level !== 3"}],attrs:{size:"mini"},on:{click:function(t){e.selectNode(0)}}},[e._v(e._s(e.isActivated?"取消选择":"选择"))]),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:3!==e.father.level,expression:"father.level !== 3"}],on:{click:function(t){e.cancelGroup(e.filterItem)}}},[e._v("取消组 ")]),e._v(" "),n("el-button",{on:{click:function(t){e.changOperator(e.filterItem)}}},[e._v("更改为"+e._s("and"===e.filterItem.operator?"或":"和"))]),e._v(" "),n("el-button",{directives:[{name:"show",rawName:"v-show",value:3!==e.father.level,expression:"father.level !== 3"}],attrs:{size:"mini"},on:{click:e.deleteMe}},[e._v("删除")])],1)]),e._v(" "),n("el-button",{directives:[{name:"popover",rawName:"v-popover:popoverAll",arg:"popoverAll"}],staticClass:"group fl",class:{hide:1===e.filterItem.item.length||2===e.filterItem.level},attrs:{type:"info",size:"small"}},[e._v(e._s("and"===e.filterItem.operator?"和":"或"))])],1):n("div",{staticClass:"node"},[0===e.father.level?n("el-popover",{ref:"popover",attrs:{placement:"top"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{staticClass:"text-center"},[n("el-button",{attrs:{size:"mini"},on:{click:function(t){e.selectNode(1)}}},[e._v(e._s(e.isActivated?"取消选择":"选择"))]),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:e.deleteMe}},[e._v("删除")])],1)]):e._e(),e._v(" "),n("div",{staticClass:"list-item"},[n("div",{staticClass:"clearfix"},[n("el-button",{directives:[{name:"popover",rawName:"v-popover:popover",arg:"popover"}],staticClass:"group fl",attrs:{type:"info",size:"small"}},[e._v("节点")]),e._v(" "),n("div",{staticClass:"block fl"},[n("el-cascader",{attrs:{options:e.tagInfo,"change-on-select":"",props:e.props,size:"small"},on:{change:e.handleChange},model:{value:e.selectedOptions,callback:function(t){e.selectedOptions=t},expression:"selectedOptions"}}),e._v(" "),n("div",{staticClass:"tagMore"},[e.showInputText?n("div",{staticClass:"block"},[n("el-input",{attrs:{placeholder:"请输入"},on:{blur:function(t){e.blockInputChange(0)}},model:{value:e.inputText,callback:function(t){e.inputText=t},expression:"inputText"}})],1):e._e(),e._v(" "),e.showDateText?n("div",{staticClass:"block"},[n("el-date-picker",{attrs:{type:"daterange","range-separator":"至",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy/MM/dd","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{change:function(t){e.blockInputChange(1)}},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}})],1):e._e(),e._v(" "),e.showSliderText?n("div",{staticClass:"block"},[n("div",{staticClass:"text"},[n("el-input",{attrs:{placeholder:"",required:""},on:{change:function(t){e.blockInputChange(2)}},model:{value:e.sliderValue[0],callback:function(t){e.$set(e.sliderValue,0,t)},expression:"sliderValue[0]"}}),e._v("\n                ~ "),n("el-input",{attrs:{placeholder:"",required:""},on:{change:function(t){e.blockInputChange(2)}},model:{value:e.sliderValue[1],callback:function(t){e.$set(e.sliderValue,1,t)},expression:"sliderValue[1]"}}),e._v(" "),n("b",[e._v("元")])],1)]):e._e(),e._v(" "),e.showTableText?n("div",{staticClass:"block",on:{click:function(t){e.showsegmentTable()}}},[n("el-input",{directives:[{name:"show",rawName:"v-show",value:e.showTableText,expression:"showTableText"}],model:{value:e.tableText,callback:function(t){e.tableText=t},expression:"tableText"}})],1):e._e(),e._v(" "),e.showDate?n("div",{staticClass:"block"},[n("el-date-picker",{attrs:{type:"date","range-separator":"至",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy/MM/dd",placeholder:"选择日期"},on:{change:function(t){e.blockInputChange(3)}},model:{value:e.dateValue2,callback:function(t){e.dateValue2=t},expression:"dateValue2"}})],1):e._e()])],1)],1)])],1),e._v(" "),void 0!==e.filterItem.item?n("div",{staticClass:"next-node-container"},e._l(e.filterItem.item,function(t){return n("segment-nodes",{key:t.id,attrs:{dataInfo:e.dataInfo,filterItem:t,hasFather:!0,father:e.filterItem},on:{info:e.returnCurrentInfo,cancel:e.cancelGroup2}})})):e._e()])},staticRenderFns:[]};var v=n("vSla")(f,m,!1,function(e){n("1hDl")},"data-v-7e92019b",null).exports,b={name:"member-edit",components:{CommonForm:r.a,SegmentNodes:v,ConditionDesign:d.a},data:function(){return{tabName:"condition",isLoading:!1,form:{segmentName:"",isStatic:"1",isActivated:"1",segmentDesc:"",segmentJson:"",version:""},layoutConfig:{xs:24,sm:12,md:8},formConfig:[{type:1,label:"细分名称",key:"segmentName"},{type:3,label:"细分类型:",key:"isStatic",options:[]},{type:3,label:"状态",key:"isActivated",options:[]},{type:2,label:"细分描述",key:"segmentDesc"}],segmentBtns:[{icon:"el-icon-plus",text:"添加",cb:this.handleCreateItem},{icon:"el-icon-circle-plus-outline",text:"和",cb:this.handleAddLogic},{icon:"el-icon-refresh",text:"或",cb:this.handleAddLogic}],previewBtns:[{icon:"",cb:this.preview(),text:"预览"},{icon:"",cb:this.preview(),text:"预览ES"}],selectedItems:[],funcs:{handleSelectItem:this.handleSelectItem,handleCancelGroup:this.handleCancelGroup,handleChangeLogic:this.handleChangeLogic,handleDeleteItem:this.handleDeleteItem,handleCascaderChange:this.handleCascaderChange},tagInfo:[],cascadeOptions:[],segmentList:[]}},methods:{handleSave:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var n=t.$route.params.id;"0"!==n?(t.form.id=n,Object(c.f)(t.form).then(function(e){t.$router.push("/member/member-list"),l.Message.success("修改成功")})):Object(c.a)(t.form).then(function(e){l.Message.success("保存成功"),t.$router.push("/member/member-list")})})},preview:function(){},loadDetail:function(e){var t=this;this.isLoading=!0,Object(c.c)(e).then(function(n){var a=n.data;t.tagInfo=_.cloneDeep(n.data.tagInfo);var i=[];if(t.tagInfo.forEach(function(e){var n={};n.value=e.tagTypeName,n.label=e.tagTypeName,n.children=[],e.tags.forEach(function(e){var i={};i.value=e.tagId,i.label=e.tagCn,i.children=t.getOptions(e.tagDefine,a),n.children.push(i)}),i.push(n)}),t.cascadeOptions=i,t.formConfig[1].options=a.staticSelect,t.formConfig[2].options=a.activatedSelect,null!=e){var o=a;t.form.segmentName=o.segmentName,t.form.segmentDesc=o.segmentDesc,t.form.isStatic=void 0!==o.isStatic?o.isStatic+"":"1",t.form.isActivated=void 0!==o.isActivated?o.segmentName+"":"1"}t.isLoading=!1}).catch(function(e){console.log(e),t.isLoading=!1})},handleCustomerTab:function(){},handleCreateItem:function(){this.segmentList.push({operator:"",level:1,isSelect:!1,isRoot:!0,funcs:this.funcs,cascadeOptions:this.cascadeOptions,selectValue:null,inputValue:null,type:1})},handleAddLogic:function(e){if(!(this.selectedItems.length<2)){var t=[],n=1;_.each(this.selectedItems,function(e){e.info.level>n&&(n=e.info.level),e.info.isSelect=!1,e.info.isRoot=!1,t.push(_.cloneDeep(e.info))});var a=_.map(this.selectedItems,function(e){return e.index});this.segmentList=_.filter(this.segmentList,function(e,t){return!a.includes(t)}),this.segmentList.push({level:n+1,isRoot:!0,isSelect:!1,funcs:this.funcs,operator:"和"==e?"and":"or",item:t}),this.selectedItems=[]}},handleSelectItem:function(e,t){e.isSelect=!e.isSelect,e.isSelect?this.selectedItems.push({index:t,info:_.cloneDeep(e)}):this.selectedItems=_.filter(this.selectedItems,function(e){e.index})},handleCancelGroup:function(e,t){var n;_.each(e.item,function(e){e.isRoot=!0}),(n=this.segmentList).splice.apply(n,[t,1].concat(s()(e.item)))},handleChangeLogic:function(e,t){"and"==e.operator?e.operator="or":e.operator="and"},handleDeleteItem:function(e,t,n,a){if(2!=e.length||t.isRoot)t.isRoot?this.segmentList=_.filter(this.segmentList,function(e){return e.key!=n}):e.splice(a,1);else{this.segmentList=function e(t){return _.each(t,function(a,i){var o=_.find(a.item,function(e){return e.key==n}),s=_.find(a.item,function(e){return e.key!=n});o?(s.isRoot=!0,t[i]=s):e(a.item)}),t}(_.cloneDeep(this.segmentList))}},handleCascaderChange:function(e,t,n){if(e[1]){var a=this.getSecondValue(e);["date","datetime"].includes(a.dataDefine)?t.type=3:"daterange"===a.tagDefine?t.type=4:"int"===a.tagDefine?t.type=1:"list"===a.tagDefine?(t.type=2,t.options=a.tagValueList):"intrange"===a.tagDefine&&(t.type=5)}},getOptions:function(e,t){var n=[],a=function(e){return _.each(e,function(e){e.label=e.text}),e};switch(e){case"int":n=a(t.operationNumberSelect);break;case"list":case"float":n=a(t.operationBoolSelect);break;case"intrange":n=a(t.operationRangeSelect);break;case"multiselect":n=a(t.operationMultiSelect);break;case"string":n=a(t.operationStringSelect);break;case"daterange":n=a(t.operationRangeSelect);break;case"date":case"datetime":n=a(t.operationDatetimeSelect)}return n},getSecondValue:function(e){var t=_.find(this.tagInfo,function(t){return t.tagTypeName==e[0]});return _.find(t.tags,function(t){return t.tagId==e[1]})},dealWithSubmitData:function(e){var t=this;return function e(n){return _.each(n,function(a,o){var s={operator:a.operator,level:a.level,isRoot:a.isRoot};if(a.item&&(s.item=a.item),1==a.level){var l=a.selectValue,r=t.getSecondValue(l),c="daterange"==r.dataDefine?a.inputValue[0]+" - "+a.inputValue[1]:a.inputValue;s=i()({type:a.type,isRoot:a.isRoot,operator:"",level:a.level,groupName:l[0]},r,{operation:l[2],value:c})}n[o]=s,e(a.item)}),n}(e)},dealWithResponseData:function(e){var t=this;return function e(n){return _.each(n,function(a,i){var o={operator:a.operator,level:a.level,funcs:t.funcs,isSelect:!1,isRoot:a.isRoot};if(a.item&&(o.item=a.item),1==a.level){var s="daterange"==a.dataDefine?a.value.split(" - "):a.value;o={operator:"",level:a.level,funcs:t.funcs,isSelect:!1,isRoot:a.isRoot,type:a.type,cascadeOptions:t.cascadeOptions,selectValue:[a.groupName,a.fieldValue,a.operation],inputValue:s}}n[i]=o,a.item&&e(a.item)}),n}(e)},setTree:function(){var e=0;!function t(n){_.each(n,function(n){if(e++,n.key=e,n.style={},n.level>1){var a=0,i=function e(t){_.each(t,function(t){1==t.level&&a++,t.item&&e(t.item)})};n.item&&n.item[0]&&n.item[0].item?(i(n.item[0].item),n.style.paddingTop=(56*a-16)/2+"px",a=0):n.style.paddingTop="20px",n.item&&n.item[n.item.length-1]&&n.item[n.item.length-1].item?(i(n.item[n.item.length-1].item),n.style.paddingBottom=(56*a+14)/2+"px",a=0):n.style.paddingBottom="35px",t(n.item)}})}(this.segmentList)}},mounted:function(){"0"===this.$route.params.id?this.loadDetail(null):this.loadDetail({segmentTypeId:this.$route.params.segmentTypeId,segmentId:this.$route.params.segmentId})},watch:{segmentList:function(){console.log(this.segmentList),this.setTree()}}},I={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"edit-container"},[n("div",{staticClass:"segment-nodes"},[n("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleCustomerTab},model:{value:e.tabName,callback:function(t){e.tabName=t},expression:"tabName"}},[n("el-tab-pane",{attrs:{label:"细分条件设置",name:"condition"}},[n("div",{staticClass:"segment-btns"},e._l(e.segmentBtns,function(t){return n("el-button",{key:t.text,attrs:{type:t.type,icon:t.icon,type:"primary"},on:{click:function(e){t.cb(t.text)}}},[e._v(e._s(t.text))])})),e._v(" "),n("div",{staticClass:"segment-container"},[n("condition-design",{attrs:{list:e.segmentList}})],1),e._v(" "),e._l(e.previewBtns,function(t){return n("el-button",{key:t.text,attrs:{icon:t.icon}},[e._v(e._s(t.text))])})],2),e._v(" "),n("el-tab-pane",{attrs:{label:"细分人群列表",name:"condition2"}},[e._v("细分人群列表")])],1)],1),e._v(" "),n("div",{staticClass:"panel"},[n("h4",[e._v("细分基础信息")]),e._v(" "),n("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],ref:"form",staticClass:"member-detail",attrs:{model:e.form,"label-width":"80px","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[n("common-form",{attrs:{formConfig:e.formConfig,layoutConfig:e.layoutConfig,form:e.form}}),e._v(" "),n("div",{staticClass:"text-right"},[n("el-button",[e._v("保存")]),e._v(" "),n("router-link",{attrs:{to:"/segment/customer-list"}},[n("el-button",[e._v("返回列表")])],1)],1)],1)],1)])},staticRenderFns:[]};var x=n("vSla")(b,I,!1,function(e){n("FZZB")},"data-v-785d2790",null);t.default=x.exports},"9xel":function(e,t,n){(e.exports=n("BkJT")(!1)).push([e.i,"\n.nodes-container[data-v-785d2790] {\n  margin: 15px;\n}\n.edit-container .segment-nodes[data-v-785d2790] {\n  margin-bottom: 20px;\n}\n",""])},FZZB:function(e,t,n){var a=n("9xel");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("8bSs")("69e9c3e3",a,!0)},Jq2h:function(e,t,n){(e.exports=n("BkJT")(!1)).push([e.i,"\n.el-popover[data-v-7e92019b] {\n  min-width: 80px;\n}\n.node-container[data-v-7e92019b] {\n  margin: 20px 0 20px 0;\n  position: relative;\n  font-size: 0;\n}\n.node-container.isActivated .node[data-v-7e92019b] {\n  display: inline-block;\n  height: 34px;\n}\n.node-container.isActivated .group[data-v-7e92019b] {\n  background-color: #2c3e50;\n  color: #fff;\n}\n.node-container .node[data-v-7e92019b] {\n  border-radius: 2px;\n  display: inline-block;\n  vertical-align: middle;\n}\n.node-container .node .block[data-v-7e92019b] {\n  min-width: 300px;\n  display: inline-block;\n  vertical-align: middle;\n}\n.node-container .node .block .sliderBlock[data-v-7e92019b] {\n  min-width: 280px;\n  position: absolute;\n}\n.node-container .node .block .text[data-v-7e92019b] {\n  background-color: #f5f7fa;\n  background-image: none;\n  border-radius: 4px;\n  border: 1px solid #dcdfe6;\n  height: 30px;\n  line-height: 30px;\n  padding: 0 15px;\n  cursor: pointer;\n}\n.node-container .node .block .text .el-input[data-v-7e92019b] {\n  width: 100px;\n}\n.node-container .node .block .text .el-input .el-input__inner[data-v-7e92019b] {\n  height: 28px;\n  line-height: 28px;\n}\n.node-container .group[data-v-7e92019b] {\n  margin-right: 20px;\n  position: relative;\n  width: 56px;\n  border: 1px solid #aaa;\n  border-radius: 10px;\n  background-color: #eee;\n  color: #3c8dbc;\n}\n.node-container .group[data-v-7e92019b]:after {\n  position: absolute;\n  content: ' ';\n  display: block;\n  width: 21px;\n  height: 1px;\n  background-color: #909399;\n  right: -21px;\n  top: 0;\n  bottom: 0;\n  margin: auto 0;\n}\n.node-container .group .el-input__inner[data-v-7e92019b] {\n  padding: 0 50px;\n}\n.node-container .tagMore[data-v-7e92019b] {\n  display: inline-block;\n  vertical-align: top;\n}\n.segment-container[data-v-7e92019b] {\n  min-width: 1000px;\n  margin: 15px 0;\n}\n.segment-container .operator[data-v-7e92019b] {\n  display: inline-block;\n  vertical-align: middle;\n}\n.segment-container .operator[data-v-7e92019b]:after,\n.segment-container .operator[data-v-7e92019b]:before {\n  content: '';\n  display: block;\n  position: absolute;\n  background-color: #909399;\n  left: 0;\n  right: 0;\n  margin: auto;\n  height: 15px;\n  width: 1px;\n}\n.segment-container .operator[data-v-7e92019b]:before {\n  top: -15px;\n}\n.segment-container .operator[data-v-7e92019b]:after {\n  bottom: -15px;\n}\n.node-container>.next-node-container[data-v-7e92019b]:after {\n  display: none;\n}\n.node-container .next-node-container[data-v-7e92019b] {\n  display: inline-block;\n  vertical-align: middle;\n}\n.selectAll[data-v-7e92019b] {\n  display: inline-block;\n  vertical-align: middle;\n  z-index: 1;\n  margin-right: 18px;\n}\n.selectAll.onlyOne[data-v-7e92019b] {\n  margin-right: -24px;\n}\n.lineBox[data-v-7e92019b] {\n  width: 20px;\n  position: absolute;\n  border-left: 1px solid #909399;\n  border-top: 1px solid #909399;\n  border-bottom: 1px solid #909399;\n  left: 76px;\n  bottom: 0;\n  margin: auto;\n  top: 0;\n}\n.lineBox2[data-v-7e92019b] {\n  height: 0;\n  border-bottom: none;\n}\n.lineBox.level3[data-v-7e92019b] {\n  bottom: auto;\n  top: -30px;\n}\n",""])},"VM/Q":function(e,t,n){var a=n("l4f9");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("8bSs")("47cd57f2",a,!0)},YvLT:function(e,t,n){"use strict";t.d=function(e){return Object(a.a)({url:"/segment/segment/query",method:"get",params:e})},t.e=function(e){return Object(a.a)({url:"/segment/segment/init",method:"get",params:e})},t.c=function(e){return Object(a.a)({url:"/segment/segment/detail",method:"get",params:e})},t.b=function(e){return Object(a.a)({url:"/segment/segment/delete",method:"post",data:e})},t.a=function(e){return Object(a.a)({url:"/member/member/save",method:"post",data:e})},t.f=function(e){return Object(a.a)({url:"/member/member/update",method:"post",data:e})};var a=n("vLgD")},l4f9:function(e,t,n){(e.exports=n("BkJT")(!1)).push([e.i,"\n.flex {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.flex-l {\n  -ms-flex-preferred-size: 15%;\n      flex-basis: 15%;\n  position: relative;\n}\n.flex-r {\n  -ms-flex-preferred-size: 85%;\n      flex-basis: 85%;\n  position: relative;\n}\n.logic-btn {\n  width: 70px;\n  height: 30px;\n  line-height: 30px;\n  text-align: center;\n  background: #fff;\n  border: 1px solid #c0c4cc;\n  border-radius: 15px;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: -37px;\n  z-index: 1;\n  margin: auto;\n}\n.active {\n  background: gray;\n  color: #fff;\n}\n.connect-box {\n  height: 100%;\n  position: absolute;\n  left: 0;\n  right: 0;\n  padding-left: 35px;\n}\n.connect-box .connect-box-inner {\n    height: 100%;\n    border: 2px solid #c0c4cc;\n    border-right: none;\n    position: relative;\n}\n.line {\n  height: 2px;\n  top: 19px;\n  left: 0;\n  right: 0;\n  position: absolute;\n  border-color: inherit;\n  background-color: #c0c4cc;\n}\n.inner-btn {\n  background: #fff;\n  border-radius: 15px;\n  width: 70px;\n  height: 30px;\n  line-height: 30px;\n  text-align: center;\n  border: 1px solid #c0c4cc;\n  position: absolute;\n  z-index: 1;\n  top: -8px;\n  cursor: pointer;\n}\n.active {\n  background: gray;\n  color: #fff;\n}\n.input-group {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: relative;\n  z-index: 1;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  height: 40px;\n  margin-bottom: 16px;\n}\n.input-group .cascader {\n    -ms-flex-preferred-size: 50%;\n        flex-basis: 50%;\n    margin-right: 10px;\n    position: relative;\n}\n.input-group .right-input {\n    -ms-flex-preferred-size: 50%;\n        flex-basis: 50%;\n    position: relative;\n}\n.input-group .input-valid {\n    position: absolute;\n    color: red;\n    top: 34px;\n    font-size: 12px;\n}\n.range-box .el-input {\n  width: 150px;\n}\n",""])}});