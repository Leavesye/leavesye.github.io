webpackJsonp([20],{"1vOR":function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=t("rVsN"),a=t.n(r),i=t("0j9R"),n=t("IEd/"),s=t("0xDb"),d={name:"coupon-edit",components:{CommonForm:i.a},data:function(){var e=this,o=function(e,o){var t=new Date(e),r=new Date(o);return!(t.getTime()>r.getTime())||(console.log("第一个大"),!1)};return{isLoading:!1,form:{couponId:"",status:"",sendPlatform2:"",couponName:"",couponType:"",timeLimitType:"",sendPlatform:"",language:"",shortDescription:"",fullDescription:"",awardType:"1",awardTypeMult:"",awardTypeAdd:"",validDays:"",effectDays:"",startDate:"",endDate:"",currency:"",couponNums:"",avalBrand:"",brandCode:"",skuCode:[],avalSku:"",avalStore:"",storeCode:"",avalGrade:"",gradeCode:""},formList:{brandList:[],storeList:[],gradeList:[],skuList:[]},rules:{couponName:[{required:!0,message:"优惠券名称不能为空",trigger:"blur"}],couponType:[{required:!0,message:"优惠券类型不能为空",trigger:"blur"}],timeLimitType:[{required:!0,message:"时间期限类型不能为空",trigger:"blur"}],sendPlatform:[{required:!0,message:"优惠券发送方式不能为空",trigger:"blur"}],language:[{required:!0,message:"优惠券语言不能为空",trigger:"blur"}],awardType:[{required:!0,message:"积分奖励方式不能为空",trigger:"blur"}],awardTypeMult:[{required:!0,message:"积分奖励倍數不能为空",trigger:"blur"}],awardTypeAdd:[{required:!0,message:"积分奖励固定值不能为空",trigger:"blur"}],validDays:[{required:!0,message:"可使用有效天数不能为空",trigger:"blur"}],effectDays:[{required:!0,message:"延时生效天数不能为空",trigger:"blur"}],startDate:[{validator:function(t,r,a){"0"!=e.$route.params.id?a():""===r?a(new Error("券有效结束日期不能为空")):o(r,(new Date).toLocaleDateString().split("/").join("-"))?a(new Error("券有效结束日期不能小于开始日期!")):a()},trigger:"blur"}],endDate:[{validator:function(t,r,a){"0"!=e.$route.params.id?a():""===r?a(new Error("券有效开始日期不能为空")):o(r,e.form.startDate)?a(new Error("券有效结束日期不能小于当前日期!")):a()},trigger:"blur"}],currency:[{required:!0,message:"现金券类型不能为空",trigger:"blur"}],couponNums:[{required:!0,message:"生成券数量不能为空",trigger:"blur"}]},layoutConfig:{xs:24,sm:12,md:12},formConfig:[[{type:1,label:"优惠券名称",key:"couponName"},{type:3,label:"优惠券类型",key:"couponType",options:[],handleSelect:this.handleSelect},{type:3,label:"时间期限类型",key:"timeLimitType",options:[],handleSelect:this.handleSelect},{type:3,label:"优惠券发送方式",key:"sendPlatform",options:[],handleSelect:this.handleSelect}],[{type:3,label:"优惠券语言",key:"language",options:[]},{type:1,label:"优惠券简述",key:"shortDescription"},{type:2,label:"优惠券详细描述",key:"fullDescription",options:[]}],[{type:6,label:"可使用有效天数",key:"validDays",hidden:!0},{type:6,label:"延时生效天数",key:"effectDays",hidden:!0},{type:4,label:"券有效开始日期",key:"startDate",hidden:!0},{type:4,label:"券有效结束日期",key:"endDate",hidden:!0},{type:3,label:"现金券类型",key:"currency",options:[],hidden:!0},{type:3,label:"积分奖励方式",key:"awardType",options:[],hidden:!0,handleSelect:this.handleSelect},{type:6,label:"积分奖励倍數",key:"awardTypeMult",hidden:!0},{type:1,label:"积分奖励固定值",key:"awardTypeAdd",hidden:!0},{type:6,label:"生成券数量",key:"couponNums",hidden:!0}]],formConfig2:[],active:0}},created:function(){this.formConfig2=[{type:5,label:"适用品牌",key:"avalBrand",cb:this.selBrand,data:[],showCheckbox:!0},{type:1,label:"适用商品",key:"avalSku"},{type:5,label:"适用渠道门店",key:"avalStore",cb:this.selStore,data:[],showCheckbox:!0},{type:5,label:"适用会员等级",key:"avalGrade",cb:this.selGrade,data:[],showCheckbox:!0}]},methods:{handleCancel:function(){this.$router.push("/template/coupon-list")},handleSelect:function(e,o){var t="";switch(o.options.forEach(function(o){e===o.value&&(t=o.text)}),t){case"现金券":this.formConfig[2][4].hidden=!1;break;case"折扣券":this.formConfig[2][4].hidden=!0,this.formConfig[2][5].hidden=!0;break;case"积分券":this.formConfig[2][6].hidden=!0,this.formConfig[2][5].hidden=!1;break;case"礼品券":this.formConfig[2][4].hidden=!0,this.formConfig[2][5].hidden=!0,this.formConfig[2][6].hidden=!0;break;case"固定期限":this.formConfig[2][0].hidden=!0,this.formConfig[2][1].hidden=!0,this.formConfig[2][2].hidden=!1,this.formConfig[2][3].hidden=!1;break;case"滚动期限":this.formConfig[2][0].hidden=!1,this.formConfig[2][1].hidden=!1,this.formConfig[2][2].hidden=!0,this.formConfig[2][3].hidden=!0;break;case"第三方平台":this.formConfig[2][8].hidden=!1;break;case"CRM平台":case"自行领券":this.formConfig[2][8].hidden=!0;break;case"固定积分":this.formConfig[2][6].hidden=!0,this.formConfig[2][7].hidden=!1;break;case"倍数积分":this.formConfig[2][7].hidden=!0,this.formConfig[2][6].hidden=!1}console.log(t)},formatStr:function(e){var o=this;e.forEach(function(e){o.form[e.name]=e.str.slice(0,e.str.length-1)})},addChildItem:function(e,o){var t=this;e.children&&e.children.forEach(function(e){t.form[o]+=e.name+",",t.addChildItem(e,o)})},removeChildItem:function(e,o){var t=this;e.children&&e.children.forEach(function(e){t.form[o]=t.form[o].replace(e.name+",",""),t.removeChildItem(e,o)})},selectItem:function(e,o){var t=o.slice(4,o.length).toLowerCase()+"Code";e.selected?(this.form[o]+=e.name+",",this.form[t]+=e.id+",",console.log(e.id),this.addChildItem(e,o)):(this.form[o]=this.form[o].replace(e.name+",",""),this.form[t]=this.form[t].replace(e.id+",",""),this.removeChildItem(e,o))},selBrand:function(e,o){this.selectItem(o,"avalBrand")},selStore:function(e,o){this.selectItem(o,"avalStore")},selGrade:function(e,o){this.selectItem(o,"avalGrade")},loadDetail:function(e){var o=this;this.isLoading=!0,Object(n.e)(e).then(function(e){var t=e;o.formConfig[0][1].options=t.couponTypeList,o.formConfig[0][2].options=t.timeLimitTypeList,o.formConfig[0][3].options=t.sendPlatformList,o.formConfig[1][0].options=t.languageList,o.formConfig[2][4].options=t.currencyList,o.formConfig[2][5].options=t.awardTypeList,o.formConfig2[0].data=t.brandList,o.formConfig2[2].data=Object(s.b)(t.storeList),o.formConfig2[3].data=t.gradeList;var r=t.coupon;switch(o.form.couponName=r.couponName,o.form.mobile=r.mobile,o.form.couponType=r.couponType?String(r.couponType):"",o.form.timeLimitType=r.timeLimitType?String(r.timeLimitType):"",o.form.sendPlatform=r.sendPlatform?String(r.sendPlatform):"",o.form.language=String(r.language),o.form.shortDescription=r.shortDescription,o.form.fullDescription=r.fullDescription,o.form.validDays=r.validDays,o.form.effectDays=r.effectDays,o.form.startDate=r.startDate,o.form.endDate=r.endDate,o.form.currency=r.currency?String(r.currency):"",o.form.awardType=r.awardType,o.form.couponNums=r.couponNums,o.form.awardTypeAdd=r.awardTypeAdd,o.form.couponType){case"1":o.formConfig[2][4].hidden=!1;break;case"2":o.formConfig[2][4].hidden=!0,o.formConfig[2][5].hidden=!0;break;case"3":case"4":o.formConfig[2][4].hidden=!0,o.formConfig[2][5].hidden=!0,o.formConfig[2][6].hidden=!0}switch(o.form.timeLimitType){case"1":o.formConfig[2][0].hidden=!0,o.formConfig[2][1].hidden=!0,o.formConfig[2][2].hidden=!1,o.formConfig[2][3].hidden=!1;break;case"2":o.formConfig[2][0].hidden=!1,o.formConfig[2][1].hidden=!1,o.formConfig[2][2].hidden=!0,o.formConfig[2][3].hidden=!0}switch(o.form.sendPlatform){case"1":o.formConfig[2][8].hidden=!1;break;case"2":o.formConfig[2][5].hidden=!0;break;case"3":o.formConfig[2][5].hidden=!0,o.formConfig[2][6].hidden=!1;break;case"4":o.formConfig[2][5].hidden=!0}o.formConfig2[0].data.forEach(function(e){e.checked&&(o.form.avalBrand+=e.name+",",e.selected=!0,o.form.brandCode=e.id+=",")}),o.formConfig2[2].data.forEach(function(e){e.checked&&(o.form.avalStore+=e.name+",",e.selected=!0,o.form.storeCode=e.id+=",")}),o.formConfig2[3].data.forEach(function(e){e.checked&&(o.form.avalGrade+=e.name+",",e.selected=!0,o.form.gradeCode=e.id+=",")}),JSON.parse(t.skuList.split("'").join('"')).forEach(function(e){o.form.avalSku+=e.name+","}),o.isLoading=!1}).catch(function(){o.isLoading=!1})},prev:function(){this.active--<0&&(this.active=0)},next:function(){var e=this;this.$refs.form.validate(function(o){if(!o)return console.log("error submit!!"),!1;Object(n.a)({couponName:e.form.couponName,couponId:e.$route.params.id}).then(function(o){2===o?e.$message({type:"error",message:"优惠券名称已经存在!"}):e.active=1})})},handleSave:function(){var e=this,o=[{name:"avalStore",str:this.form.avalStore},{name:"avalBrand",str:this.form.avalBrand},{name:"gradeCode",str:this.form.gradeCode},{name:"brandCode",str:this.form.brandCode},{name:"storeCode",str:this.form.storeCode},{name:"gradeCode",str:this.form.gradeCode},{name:"avalSku",str:this.form.avalSku},{name:"avalGrade",str:this.form.avalGrade}];this.formatStr(o),this.form.couponId=0===parseInt(this.$route.params.id)?"":this.$route.params.id,Object(n.b)(this.form).then(function(){e.$message({type:"success",message:"保存成功!"}),e.$router.push("/template/coupon-list")})}},mounted:function(){"0"===this.$route.params.id?a.a.all([this.loadDetail({flag:"add"})]):a.a.all([this.loadDetail({flag:"edit",couponId:this.$route.params.id})])}},f={render:function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],ref:"form",staticClass:"edit-container",attrs:{model:e.form,rules:e.rules,"label-width":"140px","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[t("div",{staticClass:"panel"},[t("h4",[e._v("添加优惠券模版")]),e._v(" "),t("el-steps",{attrs:{active:e.active,simple:"","finish-status":"success"}},[t("el-step",{attrs:{title:"优惠券券面配置"}}),e._v(" "),t("el-step",{attrs:{title:"优惠券使用配置"}})],1),e._v(" "),0===e.active?t("div",{staticClass:"couponForm-list"},[e._l(e.formConfig,function(o,r){return t("common-form",{key:r,attrs:{formConfig:o,layoutConfig:e.layoutConfig,form:e.form}})}),e._v(" "),t("div",{staticClass:"text-center"},[t("el-button",{attrs:{type:"primary"},on:{click:e.next}},[e._v("下一步")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.handleCancel}},[e._v("返回列表")])],1)],2):t("div",{staticClass:"useConfig-form"},[t("common-form",{attrs:{formConfig:e.formConfig2,layoutConfig:e.layoutConfig,form:e.form}}),e._v(" "),t("div",{staticClass:"text-center"},[t("el-button",{attrs:{type:"primary"},on:{click:e.prev}},[e._v("上一步")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSave}},[e._v("完成")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.handleCancel}},[e._v("返回列表")])],1)],1)],1)])},staticRenderFns:[]};var l=t("vSla")(d,f,!1,function(e){t("olgS")},"data-v-1b1f7a22",null);o.default=l.exports},"IEd/":function(e,o,t){"use strict";o.d=function(e){return Object(r.a)({url:"/coupon/coupon/list",method:"get",params:e})},o.e=function(e){return Object(r.a)({url:"/coupon/coupon/init",method:"get",params:e})},o.b=function(e){return Object(r.a)({url:"/coupon/coupon/save",method:"post",data:e})},o.c=function(e){return Object(r.a)({url:"/coupon/coupon/exportList",method:"get",params:e})},o.a=function(e){return Object(r.a)({url:"/coupon/coupon/checkCouponName",method:"get",params:e})};var r=t("vLgD")},QTwQ:function(e,o,t){(e.exports=t("BkJT")(!1)).push([e.i,"\n.couponForm-list .el-row[data-v-1b1f7a22] {\n  padding: 35px 0 15px 0;\n  border-top: 1px solid #eee;\n}\n.couponForm-list .el-row[data-v-1b1f7a22]:first-child {\n    border-top: none;\n}\n.useConfig-form[data-v-1b1f7a22] {\n  margin-top: 20px;\n}\n",""])},olgS:function(e,o,t){var r=t("QTwQ");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);t("8bSs")("e05ebe82",r,!0)}});