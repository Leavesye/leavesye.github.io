webpackJsonp([17],{DtUY:function(e,t,n){(e.exports=n("BkJT")(!1)).push([e.i,"\n.reset-form[data-v-677b91d8] {\n  margin: 20px;\n}\n.set-role[data-v-677b91d8] {\n  margin: 20px;\n}\n",""])},Rkmb:function(e,t,n){"use strict";(function(e){var s=n("rVsN"),a=n.n(s),i=n("jNdV"),o=n("0xDb"),r=n("nFx2"),c=n("Y0Uy"),l=n.n(c),d=n("1fno"),h=n("wS1x"),u=n.n(h);t.a={name:"system-userlist",components:{ListPage:r.a,VJstree:u.a},data:function(){return{showReset:!1,showSetRole:!1,resetForm:{password:"",cpwd:""},rules:{password:[{required:!0,message:"密码不能为空",trigger:"blur"}],cpwd:[{required:!0,message:"确认密码不能为空",trigger:"blur"}]},resetLayerIndex:0,setRoleLayerIndex:0,roleTree:[],roleIds:[],pc:{search:{form:{username:"",name:"",mobile:"",sex:"",status:"",sort:"id",order:"desc",offset:0,limit:10},layoutConfig:{xs:24,sm:12,md:8},formConfig:[{type:1,label:"用户名",key:"username"},{type:1,label:"姓名",key:"name"},{type:1,label:"手机号码",key:"mobile"},{type:3,label:"性别",key:"sex",options:[]},{type:3,label:"状态",key:"status",options:[]}],btns:[{text:"搜索",cb:this.handleSearch}]},functions:{checkList:["用户名","姓名","手机号码","性别","创建日期","状态"],handleExpandAll:this.handleExpandAll,rightBtns:[{text:"添加",icon:"el-icon-circle-plus",cb:this.handleAdd},{text:"编辑",icon:"el-icon-edit",cb:this.handleEdit},{text:"删除",icon:"el-icon-delete",cb:this.handleDelete},{text:"角色分配",icon:"el-icon-delete",cb:this.handleOpenSetRole},{text:"解除锁定",icon:"el-icon-delete",cb:this.handleUnlock},{text:"重置密码",icon:"el-icon-delete",cb:this.handleOpenReset}]},table:{dataList:[],handleSelectRow:this.handleSelectRow,selectedRow:null,isLoading:!1,expandAll:!1,thead:[{text:"用户名",field:"username",hidden:!1},{text:"姓名",field:"name",hidden:!1},{text:"手机号码",field:"mobile",hidden:!1},{text:"性别",field:"sex",hidden:!1},{text:"创建日期",field:"createDate",hidden:!1},{text:"状态",field:"status",hidden:!1}]},pagination:{pageSizes:[10,25,50,100],pageSize:10,handleSizeChange:this.handleSizeChange,handleCurrentChange:this.handleCurrentChange,currentPage:1,total:0}}}},watch:{"pc.functions.checkList":function(e){l.a.each(this.pc.table.thead,function(t){var n=!1;l.a.each(e,function(e){t.text==e&&(t.hidden=!1,n=!0)}),n||(t.hidden=!0)})}},methods:{handleSearch:function(){this.loadData()},handleSizeChange:function(e){this.pc.search.form.limit=e,this.pc.search.form.offset=this.pc.search.form.limit*(this.pc.pagination.currentPage-1),this.loadData()},handleCurrentChange:function(e){this.pc.pagination.currentPage=e,this.pc.search.form.offset=this.pc.search.form.limit*(this.pc.pagination.currentPage-1),this.loadData()},handleSelectRow:function(e){this.pc.table.selectedRow=e,console.log(e)},handleExpandAll:function(){this.pc.table.expandAll=!this.pc.table.expandAll},handleAdd:function(){this.$router.push("/system/user-edit/0")},handleEdit:function(){if(!this.pc.table.selectedRow)return this.$message({type:"warning",message:"请先选中表格中的某一记录！"}),!1;this.$router.push("/system/user-edit/"+this.pc.table.selectedRow.id)},handleDelete:function(){var e=this;if(!this.pc.table.selectedRow)return this.$message({type:"warning",message:"请先选中表格中的某一记录！"}),!1;this.$confirm("确定要删除吗?","信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(i.b)(e.pc.table.selectedRow.id).then(function(){e.loadData(),e.$message({type:"success",message:"删除成功!"})})}).catch(function(){})},selectWarning:function(){this.$message({type:"warning",message:"请先选中表格中的某一记录！"})},handleUnlock:function(){var e=this;if(!this.pc.table.selectedRow)return this.selectWarning(),!1;this.$confirm("确定解锁该用户？","信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(i.k)(e.pc.table.selectedRow.id).then(function(){e.loadData(),e.$message({type:"success",message:"解锁成功!"})})}).catch(function(){})},handleOpenReset:function(){if(!this.pc.table.selectedRow)return this.selectWarning(),!1;this.showReset=!0,this.resetLayerIndex=d.a.open({type:1,title:"重置密码",area:["500px","300px"],content:e("#reset-pwd")})},handleCloseReset:function(){d.a.close(this.resetLayerIndex)},handleReset:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;Object(i.i)({id:t.pc.table.selectedRow.id,password:t.resetForm.password}).then(function(){t.$message({type:"success",message:"重置密码成功"}),t.resetForm={password:"",cpwd:""},t.handleCloseReset()})})},handleOpenSetRole:function(){var t=this,n=this.pc.table.selectedRow;if(!n)return this.selectWarning(),!1;Object(i.e)(n.id).then(function(e){t.roleTree=Object(o.b)(e)}),this.showSetRole=!0,this.setRoleIndex=d.a.open({type:1,title:"用户角色分配",area:["500px","300px"],content:e("#set-role")})},handleCloseSetRole:function(){d.a.close(this.setRoleIndex)},handleSetRole:function(e){var t=this;Object(i.j)({userId:this.pc.table.selectedRow.id,roleIds:this.roleIds.toString()}).then(function(){t.$message({type:"success",message:"角色分配成功"}),t.handleCloseSetRole()})},handleClickTreeItem:function(e,t){this.roleIds.includes(t.id)?this.roleIds=l.a.filter(this.roleIds,function(e){return e!=t.id}):this.roleIds.push(t.id)},loadData:function(){var e=this;return this.pc.table.isLoading=!0,Object(i.d)(this.pc.search.form).then(function(t){console.log(t);var n=t;e.pc.table.dataList=Object(o.a)(n.rows),e.pc.pagination.total=n.total,e.pc.table.isLoading=!1}).catch(function(t){console.log(t),e.pc.table.isLoading=!1})},getOptions:function(){var e=this;return Object(i.h)().then(function(t){e.pc.search.formConfig[3].options=t.gender,e.pc.search.formConfig[4].options=t.status,console.log(e.pc.search.formConfig)}).catch(function(e){console.log(e)})},getBtns:function(){var e=this;return Object(i.g)().then(function(t){var n=t.data,s=l.a.clone(e.pc.functions.rightBtns);l.a.each(n,function(e){l.a.find(s,function(t){return t.text===e.name})||s.push({text:e.name,icon:e.icon,cb:function(){}})}),s=l.a.filter(s,function(e){return l.a.find(n,function(t){return e.text==t.name})}),e.pc.functions.rightBtns=s})}},mounted:function(){a.a.all([this.loadData(),this.getOptions(),this.getBtns()])}}}).call(t,n("L7Pj"))},TwAS:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("Rkmb"),a={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("list-page",{attrs:{pc:e.pc}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showReset,expression:"showReset"}],attrs:{id:"reset-pwd"}},[n("el-form",{ref:"resetForm",staticClass:"reset-form",attrs:{"label-position":"top","label-width":"80px",model:e.resetForm,rules:e.rules}},[n("el-form-item",{attrs:{label:"新密码",prop:"password"}},[n("el-input",{attrs:{type:"password",placeholder:"请输入新密码"},model:{value:e.resetForm.password,callback:function(t){e.$set(e.resetForm,"password",t)},expression:"resetForm.password"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"确认密码",prop:"cpwd"}},[n("el-input",{attrs:{type:"password",placeholder:"请输入确认密码"},model:{value:e.resetForm.cpwd,callback:function(t){e.$set(e.resetForm,"cpwd",t)},expression:"resetForm.cpwd"}})],1)],1),e._v(" "),n("el-row",{staticStyle:{"text-align":"center"}},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleReset("resetForm")}}},[e._v("确定")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleCloseReset}},[e._v("取消")])],1)],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.showSetRole,expression:"showSetRole"}],staticClass:"set-role",attrs:{id:"set-role"}},[n("h3",[e._v("角色分配")]),e._v(" "),n("v-jstree",{attrs:{data:e.roleTree,"show-checkbox":"","whole-row":"","allow-batch":"",multiple:"","text-field-name":"name"},on:{"item-click":e.handleClickTreeItem}}),e._v(" "),n("el-row",{staticStyle:{"text-align":"center"}},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleSetRole()}}},[e._v("确定")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleCloseSetRole}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var i=function(e){n("WyuP")},o=n("vSla")(s.a,a,!1,i,"data-v-677b91d8",null);t.default=o.exports},WyuP:function(e,t,n){var s=n("DtUY");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);n("8bSs")("4cee3007",s,!0)},jNdV:function(e,t,n){"use strict";t.g=function(){return Object(s.a)({url:"/admin/menu/system/permission/buttons/42",method:"get"})},t.d=function(e){return Object(s.a)({url:"/admin/user/users",method:"get",params:e})},t.h=function(e){return Object(s.a)({url:"/admin/user/init",method:"get",params:e})},t.c=function(){return Object(s.a)({url:"/admin/dept/init",method:"get"})},t.f=function(e){return Object(s.a)({url:"/admin/user/users/"+e,method:"get"})},t.b=function(e){return Object(s.a)({url:"/admin/user/users/"+e+"?token="+Object(a.a)(),method:"delete"})},t.a=function(e){return Object(s.a)({url:"/admin/user/users",method:"post",data:e})},t.k=function(e){return Object(s.a)({url:"/admin/user/users/"+e+"/unlock?token="+Object(a.a)(),method:"put"})},t.i=function(e){return Object(s.a)({url:"/admin/user/users/password?token="+Object(a.a)(),method:"put",data:e})},t.e=function(e){return Object(s.a)({url:"/admin/role/roles/tree/"+e,method:"get"})},t.j=function(e){return Object(s.a)({url:"/admin/role/roles/assign",method:"post",data:e})};var s=n("vLgD"),a=n("TIfe")}});