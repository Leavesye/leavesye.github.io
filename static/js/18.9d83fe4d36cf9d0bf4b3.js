webpackJsonp([18],{"+NE1":function(e,t,n){"use strict";t.g=function(){return Object(a.a)({url:"/admin/menu/system/permission/buttons/43",method:"get"})},t.d=function(e){return Object(a.a)({url:"/admin/role/roles",method:"get",params:e})},t.h=function(e){return Object(a.a)({url:"/admin/role/init",method:"get",params:e})},t.b=function(e){return Object(a.a)({url:"/admin/role/roles",method:"post",data:e})},t.i=function(e){return Object(a.a)({url:"/admin/role/roles/"+e.id+"?token="+Object(o.a)(),method:"put",data:e})},t.c=function(e){return Object(a.a)({url:"/admin/role/roles/"+e+"?token="+Object(o.a)(),method:"delete"})},t.f=function(e){return Object(a.a)({url:"/admin/role/roles/"+e+"?token="+Object(o.a)(),method:"get"})},t.e=function(e){return Object(a.a)({url:"/admin/menu/menus/auth/distribution/"+e,method:"get",params:{sort:"id",order:"desc"}})},t.a=function(e){return Object(a.a)({url:"/admin/role/roles/auth/assign",method:"post",data:e})};var a=n("vLgD"),o=n("TIfe")},BOwR:function(e,t,n){"use strict";(function(e){var a=n("rVsN"),o=n.n(a),i=n("3cXf"),c=n.n(i),l=n("+NE1"),s=n("0xDb"),r=n("nFx2"),u=n("R2oU"),d=n("0j9R"),h=n("Y0Uy"),m=n.n(h),f=n("1fno");t.a={name:"system-rolelist",components:{ListPage:r.a,CommonForm:d.a,FuncButtons:u.a},data:function(){return{type:1,showType:0,editLayer:0,authLayer:0,editForm:{id:"",name:"",description:""},layoutConfig:{xs:24,sm:24,md:24},formConfig:[{type:1,label:"角色名",key:"name"},{type:2,label:"描述",key:"description"}],rules:{name:[{required:!0,message:"角色名不能为空",trigger:"blur"}]},moduleTree:[],authFunctions:{checkList:["模块","子模块","菜单","按钮权限","数据权限"],handleExpandAll:this.handleExpandAll,rightBtns:[{text:"确定",icon:"el-icon-circle-plus",cb:this.handleSetAuth},{text:"取消",icon:"el-icon-edit",cb:this.handleCloseAuth}]},authTable:{thead:[{text:"模块",field:"moduleName"},{text:"子模块",field:"subModuleName"},{text:"菜单",field:"menuName"},{text:"按钮权限",field:"button"},{text:"数据权限",field:"button"}]},isAuthLoading:!1,pc:{search:{form:{name:"",status:"",sort:"id",order:"desc",offset:0,limit:10},layoutConfig:{xs:24,sm:12,md:8},formConfig:[{type:1,label:"角色名",key:"name"}],btns:[{text:"搜索",cb:this.handleSearch}]},functions:{checkList:["角色名","描述"],handleExpandAll:this.handleExpandAll,rightBtns:[{text:"添加",icon:"el-icon-circle-plus",cb:this.handleAdd},{text:"编辑",icon:"el-icon-edit",cb:this.handleEdit},{text:"删除",icon:"el-icon-delete",cb:this.handleDelete},{text:"权限分配",icon:"el-icon-delete",cb:this.handleOpenAuth}]},table:{dataList:[],handleSelectRow:this.handleSelectRow,selectedRow:null,isLoading:!1,expandAll:!1,thead:[{text:"角色名",field:"name",hidden:!1},{text:"描述",field:"description",hidden:!1}]},pagination:{pageSizes:[10,25,50,100],pageSize:10,handleSizeChange:this.handleSizeChange,handleCurrentChange:this.handleCurrentChange,currentPage:1,total:0}}}},watch:{"pc.functions.checkList":function(e){m.a.each(this.pc.table.thead,function(t){var n=!1;m.a.each(e,function(e){t.text==e&&(t.hidden=!1,n=!0)}),n||(t.hidden=!0)})}},methods:{handleCheckMenu:function(e){m.a.each(this.moduleTree,function(t){e.moduleId==t.moduleId&&(t.moduleChecked=e.menuChecked)})},handleDataAuthClick:function(e,t){m.a.each(t,function(t){t.text!=e.text?t.check=!1:t.check=!0})},handleCheckChange:function(e,t){console.log(e,t)},objectSpanMethod:function(e){var t=e.row;e.column,e.rowIndex;if(0===e.columnIndex)return{rowspan:t.rowspan,colspan:1}},handleSearch:function(){this.loadData()},handleSizeChange:function(e){this.pc.search.form.limit=e,this.pc.search.form.offset=this.pc.search.form.limit*(this.pc.pagination.currentPage-1),this.loadData()},handleCurrentChange:function(e){this.pc.pagination.currentPage=e,this.pc.search.form.offset=this.pc.search.form.limit*(this.pc.pagination.currentPage-1),this.loadData()},handleSelectRow:function(e){this.pc.table.selectedRow=e,console.log(e)},handleExpandAll:function(){this.pc.table.expandAll=!this.pc.table.expandAll},handleAdd:function(){this.type=1,this.showType=1,this.editLayerIndex=f.a.open({type:1,title:"添加角色",area:["500px","300px"],content:e("#role-edit")})},checkSelect:function(){return!!this.pc.table.selectedRow||(this.$message({type:"warning",message:"请先选中表格中的某一记录！"}),!1)},handleEdit:function(){var t=this;this.checkSelect()&&(this.type=2,this.showType=1,this.editForm.id=this.pc.table.selectedRow.id,Object(l.f)(this.editForm.id).then(function(e){t.editForm.name=e.name,t.editForm.description=e.description}),this.editLayer=f.a.open({type:1,title:"编辑角色",area:["500px","300px"],content:e("#role-edit")}))},resetEditForm:function(){this.editForm={name:"",description:""}},handleCloseEdit:function(){f.a.close(this.editLayer)},handleSave:function(){var e=this;this.$refs.editForm.validate(function(t){if(!t)return console.log("error submit!!"),!1;1==e.type?Object(l.b)(e.editForm).then(function(){e.$message({type:"success",message:"添加成功"}),e.handleCloseEdit(),e.loadData(),e.resetEditForm()}):Object(l.i)(e.editForm).then(function(){e.$message({type:"success",message:"修改成功"}),e.resetEditForm(),e.handleCloseEdit(),e.loadData()})})},handleSetAuth:function(){var e=this,t=[],n=[],a=this.pc.table.selectedRow.id;m.a.each(this.moduleTree,function(e){e.moduleChecked&&t.push(e.moduleId),e.menuChecked&&t.push(e.menuId),m.a.each(e.buttonList,function(e){e.check&&t.push(e.id)});var o=m.a.find(e.dataAuthList,function(e){return e.check});n.push({roleId:a,menuId:e.menuId,dataAuthLevel:o?o.value:1})});var o=t.toString(),i=c()(n);Object(l.a)({roleId:a,menuIds:o,dataAuthStr:i}).then(function(t){e.handleCloseAuth(),e.$message({type:"success",message:"角色权限分配成功"})})},handleOpenAuth:function(){var t=this;this.checkSelect()&&(this.showType=2,this.isAuthLoading=!0,Object(l.e)(this.pc.table.selectedRow.id).then(function(e){var n=0,a=m.a.groupBy(e.rows,function(e){return e.moduleId});m.a.each(e.rows,function(e){e.moduleId!=n?(e.rowspan=a[e.moduleId].length,n=e.moduleId):e.rowspan=0}),t.moduleTree=e.rows,t.isAuthLoading=!1}).catch(function(){t.isAuthLoading=!1}),this.authLayer=f.a.open({type:1,title:"角色权限分配",area:["90%","90%"],content:e("#role-auth")}))},handleCloseAuth:function(){f.a.close(this.authLayer)},handleDelete:function(){var e=this;if(!this.pc.table.selectedRow)return this.$message({type:"warning",message:"请先选中表格中的某一记录！"}),!1;this.$confirm("确定要删除吗?","信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(l.c)(e.pc.table.selectedRow.id).then(function(){e.loadData(),e.$message({type:"success",message:"删除成功!"})})}).catch(function(){})},loadData:function(){var e=this;return this.pc.table.isLoading=!0,Object(l.d)(this.pc.search.form).then(function(t){console.log(t);var n=t;e.pc.table.dataList=Object(s.a)(n.rows),e.pc.pagination.total=n.total,e.pc.table.isLoading=!1}).catch(function(t){console.log(t),e.pc.table.isLoading=!1})},getOptions:function(){return Object(l.h)().then(function(e){}).catch(function(e){console.log(e)})},getBtns:function(){var e=this;return Object(l.g)().then(function(t){var n=t.data,a=m.a.clone(e.pc.functions.rightBtns);m.a.each(n,function(e){m.a.find(a,function(t){return t.text===e.name})||a.push({text:e.name,icon:e.icon,cb:function(){}})}),a=m.a.filter(a,function(e){return m.a.find(n,function(t){return e.text==t.name})}),e.pc.functions.rightBtns=a})}},mounted:function(){o.a.all([this.loadData(),this.getOptions(),this.getBtns()])}}}).call(t,n("L7Pj"))},VH0h:function(e,t,n){(e.exports=n("BkJT")(!1)).push([e.i,"\n.edit-form[data-v-fbf5b456] {\n  margin: 20px;\n}\n.el-checkbox[data-v-fbf5b456] {\n  display: inline;\n  margin: 3px;\n}\n.el-checkbox .el-checkbox__label[data-v-fbf5b456] {\n    padding-left: 5px;\n}\n.el-radio + .el-radio[data-v-fbf5b456] {\n  margin-left: 10px;\n}\n#role-auth[data-v-fbf5b456] {\n  margin: 20px;\n  padding-bottom: 20px;\n}\n",""])},lPLs:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("BOwR"),o={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("list-page",{attrs:{pc:e.pc}}),e._v(" "),n("input",{attrs:{type:"radio"}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:1==e.showType,expression:"showType==1"}],attrs:{id:"role-edit"}},[n("el-form",{ref:"editForm",staticClass:"edit-form",attrs:{"label-position":"left","label-width":"80px",model:e.editForm,rules:e.rules}},[n("common-form",{attrs:{formConfig:e.formConfig,layoutConfig:e.layoutConfig,form:e.editForm}}),e._v(" "),n("el-row",{staticStyle:{"text-align":"center"}},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleSave()}}},[e._v("确定")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.handleCloseEdit}},[e._v("取消")])],1)],1)],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:2==e.showType,expression:"showType==2"},{name:"loading",rawName:"v-loading",value:e.isAuthLoading,expression:"isAuthLoading"}],attrs:{id:"role-auth","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading"}},[n("func-buttons",{attrs:{pcFun:e.authFunctions,pcTable:e.authTable}}),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.moduleTree,"span-method":e.objectSpanMethod,border:""}},[e.authFunctions.checkList.includes("模块")?n("el-table-column",{attrs:{prop:"moduleName",label:"模块"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{on:{change:function(n){e.handleCheckChange(t.row,e.moduleTree)}},model:{value:t.row.moduleChecked,callback:function(n){e.$set(t.row,"moduleChecked",n)},expression:"scope.row.moduleChecked"}},[e._v(e._s(t.row.moduleName))])]}}])}):e._e(),e._v(" "),e.authFunctions.checkList.includes("子模块")?n("el-table-column",{attrs:{prop:"",label:"子模块"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.subModuleName?n("el-checkbox",{model:{value:t.row.subModuleChecked,callback:function(n){e.$set(t.row,"subModuleChecked",n)},expression:"scope.row.subModuleChecked"}},[e._v(e._s(t.row.subModuleName))]):e._e(),e._v(" "),t.row.subModuleName?e._e():n("div",[e._v("-")])]}}])}):e._e(),e._v(" "),e.authFunctions.checkList.includes("菜单")?n("el-table-column",{attrs:{prop:"menuName",label:"菜单"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-checkbox",{on:{change:function(n){e.handleCheckMenu(t.row)}},model:{value:t.row.menuChecked,callback:function(n){e.$set(t.row,"menuChecked",n)},expression:"scope.row.menuChecked"}},[e._v(e._s(t.row.menuName))])]}}])}):e._e(),e._v(" "),e.authFunctions.checkList.includes("按钮权限")?n("el-table-column",{attrs:{prop:"buttonList",label:"按钮权限"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.buttonList,function(t){return n("el-checkbox",{key:t.name,attrs:{label:t.name},model:{value:t.check,callback:function(n){e.$set(t,"check",n)},expression:"item.check"}})})}}])}):e._e(),e._v(" "),e.authFunctions.checkList.includes("数据权限")?n("el-table-column",{attrs:{prop:"dataAuthList",label:"数据权限"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.dataAuthList,function(a){return n("el-checkbox",{key:a.text,attrs:{label:a.text},on:{change:function(n){e.handleDataAuthClick(a,t.row.dataAuthList)}},model:{value:a.check,callback:function(t){e.$set(a,"check",t)},expression:"item.check"}})})}}])}):e._e()],1)],1)],1)},staticRenderFns:[]};var i=function(e){n("vgFu")},c=n("vSla")(a.a,o,!1,i,"data-v-fbf5b456",null);t.default=c.exports},vgFu:function(e,t,n){var a=n("VH0h");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("8bSs")("2af03ac1",a,!0)}});