webpackJsonp([8],{"/Qi2":function(e,t,n){"use strict";t.b=function(e){return Object(a.a)({url:"/wmt/wechatTemplateCustomize/list",method:"get",params:e})},t.a=function(e){return Object(a.a)({url:"/wmt/wechatTemplateCustomize/detail",method:"get",params:e})};var a=n("vLgD")},"5JF1":function(e,t,n){"use strict";(function(e){var a=n("/Qi2"),o=n("dizt"),i=n("0xDb"),r=n("bwjF"),c=n("nFx2"),l=n("W9rQ"),s=n("1fno"),d=n("Y0Uy"),m=n.n(d);t.a={name:"custom-list",components:{ListPage:c.a,templateEdit:l.a,WechatFloat:r.a},data:function(){var e=this;return{pc:{search:{form:{sort:"id",order:"desc",offset:0,limit:10,publicaccountid:"gh_7312247e930f",customizeName:"",menuId:229},layoutConfig:{xs:24,sm:12,md:6},formConfig:[{type:1,label:"定制模板名称 ",key:"customizeName"}],btns:[{text:"搜索",cb:this.handleSearch}]},functions:{checkList:["定制名称","模板内容","内容预览","状态"],handleExpandAll:this.handleExpandAll,rightBtns:[{text:"添加",icon:"el-icon-circle-plus",cb:this.handleAdd},{text:"编辑",icon:"el-icon-edit",cb:this.handleEdit}]},table:{dataList:[],handleSelectRow:this.handleSelectRow,selectedRow:null,isLoading:!1,expandAll:!1,thead:[{text:"定制名称",field:"customize_name",hidden:!1},{text:"模板内容",field:"template_content",hidden:!1},{text:"内容预览",field:"content_preview",hidden:!1},{text:"状态",field:"status",hidden:!1}]},pagination:{pageSizes:[10,25,50,100],pageSize:10,handleSizeChange:this.handleSizeChange,handleCurrentChange:this.handleCurrentChange,currentPage:1,total:0}},template:{isLoading:!1,form:{customizeName:"",wxtemplateManageId:"",templateContent:"",contentPreview:"",content:"",name:"",remark:"",first:"",productType:"",points:"",date:"",keyword1:"",keyword2:""},rules:{content:[{required:!0,trigger:"change",validator:function(t,n,a){e.template.form.contentPreview=n,console.log(e.template.form.contentPreview,n),0===n.length?(e.template.form.contentPreview="{{content.DATA}}",a(new Error("content不能为空"))):a()}}],name:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{name.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{name.DATA}}"+o[1],a(new Error("name不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}],remark:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{remark.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{remark.DATA}}"+o[1],a(new Error("remark不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}],first:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{first.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{first.DATA}}"+o[1],a(new Error("first不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}],productType:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{productType.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{productType.DATA}}"+o[1],a(new Error("productType不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}],points:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{points.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{points.DATA}}"+o[1],a(new Error("points不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}],date:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{date.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{date.DATA}}"+o[1],a(new Error("date不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}],keyword1:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{keyword1.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{keyword1.DATA}}"+o[1],a(new Error("keyword1不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}],keyword2:[{required:!0,trigger:"change",validator:function(t,n,a){var o=e.template.form.templateContent.split("{{keyword2.DATA}}");0===n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+"{{keyword2.DATA}}"+o[1],a(new Error("keyword2不能为空"))):0!==n.length?(e.template.form.contentPreview="",e.template.form.contentPreview=o[0]+n+o[1]):a()}}]},layoutConfig:{xs:24,sm:12,md:24},formConfig:[{type:1,label:"名称",key:"customizeName"},{type:3,label:"选择模板",key:"wxtemplateManageId",options:[],handleSelect:this.handleSelect},{type:2,label:"模板内容",key:"templateContent",disabled:!0},{type:2,label:"预览",key:"contentPreview",disabled:!0},{type:2,label:"content",key:"content",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"name",key:"name",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"remark",key:"remark",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"first",key:"first",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"productType",key:"productType",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"points",key:"points",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"date",key:"date",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"keyword1",key:"keyword1",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]},{type:2,label:"keyword2",key:"keyword2",insert:!0,cb:this.chooseTree,hidden:!0,tagTree:[]}],layer:null,edit:!0,validateData:{content:"{{content.DATA}}",name:"{{name.DATA}}",remark:"{{remark.DATA}}",first:"{{first.DATA}}",productType:"{{productType.DATA}}",points:"{{points.DATA}}",date:"{{date.DATA}}",keyword1:"{{keyword1.DATA}}",keyword2:"{{keyword2.DATA}}"}}}},watch:{"pc.functions.checkList":function(e){m.a.each(this.pc.table.thead,function(t){var n=!1;m.a.each(e,function(e){t.text===e&&(t.hidden=!1,n=!0)}),n||(t.hidden=!0)})}},methods:{handleSearch:function(){this.loadData()},handleSizeChange:function(e){this.pc.search.form.limit=e,this.pc.search.form.offset=this.pc.search.form.limit*(this.pc.pagination.currentPage-1),this.loadData()},handleCurrentChange:function(e){this.pc.pagination.currentPage=e,this.pc.search.form.offset=this.pc.search.form.limit*(this.pc.pagination.currentPage-1),this.loadData()},handleSelectRow:function(e){this.pc.table.selectedRow=e,console.log(e)},handleExpandAll:function(){this.pc.table.expandAll=!this.pc.table.expandAll},handleAdd:function(){this.getDetail(0),this.template.layer=s.a.open({type:1,title:"添加微信定制模版",shadeClose:!0,shade:!1,maxmin:!0,area:["920px","600px"],content:e("#template-edit")})},handleEdit:function(){null===this.pc.table.selectedRow?this.$message({message:"请先选中表格中的某一记录",type:"error"}):(this.getDetail(1),this.template.layer=s.a.open({type:1,title:"编辑微信定制模版",shadeClose:!0,shade:!1,maxmin:!0,area:["800px","600px"],content:e("#template-edit")}))},handleCommand:function(e){this.pc.search.form.publicaccountid=e,this.loadData()},handleSelect:function(e,t){var n=this;switch(this.template.validateData={content:"{{content.DATA}}",name:"{{name.DATA}}",remark:"{{remark.DATA}}",first:"{{first.DATA}}",productType:"{{productType.DATA}}",points:"{{points.DATA}}",date:"{{date.DATA}}",keyword1:"{{keyword1.DATA}}",keyword2:"{{keyword2.DATA}}"},t.options.forEach(function(t){if(e===t.value)return n.template.form.templateContent=t.content,void(n.template.form.contentPreview=t.content)}),e){case"4":this.template.formConfig[4].hidden=!1,this.template.formConfig[7].hidden=!0,this.template.formConfig[8].hidden=!0,this.template.formConfig[9].hidden=!0,this.template.formConfig[10].hidden=!0,this.template.formConfig[5].hidden=!0,this.template.formConfig[6].hidden=!0,this.template.formConfig[11].hidden=!0,this.template.formConfig[12].hidden=!0;break;case"5":this.template.formConfig[4].hidden=!0,this.template.formConfig[7].hidden=!0,this.template.formConfig[8].hidden=!0,this.template.formConfig[9].hidden=!0,this.template.formConfig[10].hidden=!0,this.template.formConfig[5].hidden=!1,this.template.formConfig[6].hidden=!1,this.template.formConfig[11].hidden=!0,this.template.formConfig[12].hidden=!0;break;case"2":this.template.formConfig[5].hidden=!1,this.template.formConfig[7].hidden=!1,this.template.formConfig[8].hidden=!1,this.template.formConfig[9].hidden=!1,this.template.formConfig[10].hidden=!1,this.template.formConfig[6].hidden=!1,this.template.formConfig[4].hidden=!0,this.template.formConfig[11].hidden=!0,this.template.formConfig[12].hidden=!0;break;case"3":this.template.formConfig[6].hidden=!1,this.template.formConfig[7].hidden=!1,this.template.formConfig[11].hidden=!1,this.template.formConfig[12].hidden=!1,this.template.formConfig[4].hidden=!0,this.template.formConfig[5].hidden=!0,this.template.formConfig[8].hidden=!0,this.template.formConfig[9].hidden=!0,this.template.formConfig[10].hidden=!0}},loadData:function(){var e=this;return this.pc.table.isLoading=!0,Object(a.b)(this.pc.search.form).then(function(t){var n=t;console.log(n.rows),e.pc.table.dataList=Object(i.a)(n.rows),e.pc.pagination.total=n.total,e.pc.table.isLoading=!1}).catch(function(t){console.log(t),e.pc.table.isLoading=!1})},resetForm:function(){this.template.form={customizeName:"",wxtemplateManageId:"",templateContent:"",contentPreview:"",first:"",productType:"",name:"",points:"",date:"",remark:""}},getDetail:function(e){var t=this,n="";1===e?n=null===this.pc.table.selectedRow?"":this.pc.table.selectedRow.id:this.resetForm(),Object(a.a)({id:n,publicaccountid:this.pc.search.form.publicaccountid}).then(function(n){if(t.template.formConfig[1].options=n.wxtemplateList,t.template.formConfig[4].tagTree=Object(i.b)(n.tagTree),t.template.formConfig[5].tagTree=Object(i.b)(n.tagTree),t.template.formConfig[6].tagTree=Object(i.b)(n.tagTree),t.template.formConfig[7].tagTree=Object(i.b)(n.tagTree),t.template.formConfig[8].tagTree=Object(i.b)(n.tagTree),t.template.formConfig[9].tagTree=Object(i.b)(n.tagTree),1===e){var a=n.wxtemplateCustomize;t.template.form={customizeName:a.customizeName,wxtemplateManageId:String(a.wxtemplateManageId),templateContent:a.templateContent,contentPreview:a.templateContent}}})},handleOutput:function(e,t){console.log(e,t)},getBtns:function(){var e=this;return Object(o.a)(229).then(function(t){var n=t.data,a=m.a.clone(e.pc.functions.rightBtns);m.a.each(n,function(e){m.a.find(a,function(t){return t.text===e.name})||a.push({text:e.name,icon:e.icon,cb:function(){}})}),a=m.a.filter(a,function(e){return m.a.find(n,function(t){return e.text===t.name})}),e.pc.functions.rightBtns=a})},close:function(){s.a.close(this.template.layer)},chooseTree:function(){}},mounted:function(){this.getBtns()}}}).call(t,n("L7Pj"))},"8VNF":function(e,t,n){(e.exports=n("BkJT")(!1)).push([e.i,"\n.box-card[data-v-accf288a] {\n  background: #666;\n  font-size: 14px;\n  font-weight: bold;\n  position: absolute;\n  right: 0;\n  top: 90px;\n  overflow: visible;\n  line-height: 1.5;\n}\n.box-card .icon[data-v-accf288a] {\n    color: green;\n    position: absolute;\n    left: -28px;\n    top: 1px;\n    z-index: 10;\n    background: #fff;\n    padding: 4px;\n    width: 30px;\n    height: 30px;\n    -webkit-box-shadow: -2px 1px 6px #ddd;\n    box-shadow: -1px 0px 4px #ddd;\n}\n.box-card .icon svg.svg-icon[data-v-accf288a] {\n      width: 24px;\n      height: 24px;\n      padding: 3px;\n      -webkit-animation: fa-spin 2s infinite linear;\n      animation: fa-spin 2s infinite linear;\n}\n",""])},"E+qP":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("5JF1"),o={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"coupon-container"},[t("list-page",{attrs:{pc:this.pc}}),this._v(" "),t("wechat-float",{on:{handleCommand:this.handleCommand}}),this._v(" "),t("template-edit",{attrs:{template:this.template},on:{close:this.close}})],1)},staticRenderFns:[]};var i=function(e){n("iOXt")},r=n("vSla")(a.a,o,!1,i,"data-v-14af2a50",null);t.default=r.exports},"F/sw":function(e,t,n){var a=n("8VNF");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("8bSs")("791c6d7b",a,!0)},bwjF:function(e,t,n){"use strict";var a=n("3cXf"),o=n.n(a),i=n("tjM6"),r={name:"wechat-float",data:function(){return{float:{hidden:!0,accountList:[],curraccount:{accountName:"",originalId:""}}}},beforeMount:function(){this.getAccountList()},methods:{getAccountList:function(){var e=this;void 0===window.localStorage.getItem("accountList")||null===window.localStorage.getItem("accountList")?Object(i.a)().then(function(t){e.float.accountList=t,e.float.curraccount=t[0],window.localStorage.setItem("curraccount",o()(t[0])),window.localStorage.setItem("accountList",o()(t)),e.$emit("handleCommand",t[0].originalId)}).catch(function(e){console.log(e)}):(this.float.accountList=JSON.parse(window.localStorage.getItem("accountList")),this.float.curraccount=JSON.parse(window.localStorage.getItem("curraccount")),this.$emit("handleCommand",this.float.curraccount.originalId))},handleCommand:function(e){var t=this;this.$confirm("确定要切换当前公众号至："+e.accountName+"?","信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.float.curraccount=e,window.localStorage.setItem("curraccount",o()(e)),t.$emit("handleCommand",e.originalId)}).catch(function(){t.$message({type:"info",message:"已取消切换"})})}}},c={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"box-card"},[n("div",{staticClass:"icon",on:{click:function(t){e.float.hidden=!e.float.hidden}}},[n("svg-icon",{attrs:{"icon-class":"fa fa-weixin"}})],1),e._v(" "),e.float.hidden?n("el-card",[n("p",{staticClass:"title"},[e._v("当前公众号: "+e._s(e.float.curraccount.accountName))]),e._v(" "),n("el-dropdown",{on:{command:e.handleCommand}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n          切换公众号:"),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.float.accountList,function(t,a){return n("el-dropdown-item",{key:a,attrs:{command:t}},[e._v(e._s(t.accountName))])}))],1)],1):e._e()],1)},staticRenderFns:[]};var l=n("vSla")(r,c,!1,function(e){n("F/sw")},"data-v-accf288a",null);t.a=l.exports},iOXt:function(e,t,n){var a=n("n79Q");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);n("8bSs")("a25d6046",a,!0)},n79Q:function(e,t,n){(e.exports=n("BkJT")(!1)).push([e.i,"",""])},tjM6:function(e,t,n){"use strict";t.b=function(e){return Object(a.a)({url:"/wmt/wechatTemplate/list",method:"get",params:e})},t.c=function(e){return Object(a.a)({url:"/wmt/wechatTemplate/wxtemplateSync",method:"get",params:e})},t.d=function(e){return Object(a.a)({url:"/wmt/wechatTemplate/viewWxtemplate",method:"post",data:e})},t.a=function(){return Object(a.a)({url:"/wmt/publicAccount/auth/accountList",method:"get"})};var a=n("vLgD")}});